<html lang="en" x-data="{
    isDark: localStorage.getItem('isDark') === 'true',
    movies: [],
    allMovies: [],
    genres: [],
    countries: [],
    languages: [],
    franchises: [],
    selectedMovie: null,
    selectedPerson: null,
    searchQuery: '',
    selectedGenre: '',
    selectedCountry: '',
    selectedLanguage: '',
    selectedFranchise: '',
    selectedYear: '',
    sortBy: 'name',
    sortOrder: 'asc',
    activeTab: 'general',
    isLoading: true,
    viewMode: 'grid',
    currentPage: 1,
    moviesPerPage: 24,
    showFilters: false,
    statistics: null,
    currentView: 'movies',
    
    init() {
        this.isDark = localStorage.getItem('isDark') === 'true' || false;
        this.$watch('isDark', val => localStorage.setItem('isDark', val));

        Promise.all([
            fetch('/api/movies').then(res => res.json()),
            fetch('/api/genres').then(res => res.json()),
            fetch('/api/countries').then(res => res.json()),
            fetch('/api/languages').then(res => res.json()),
            fetch('/api/franchises').then(res => res.json()),
            fetch('/api/statistics').then(res => res.json())
        ]).then(([movies, genres, countries, languages, franchises, statistics]) => {
            this.allMovies = movies;
            this.movies = movies;
            this.genres = genres;
            this.countries = countries;
            this.languages = languages;
            this.franchises = franchises;
            this.statistics = statistics;
            this.isLoading = false;
            
            // Initial routing call once data is loaded
            this.router();
        }).catch(err => {
            console.error('Failed to load data:', err);
            this.isLoading = false;
        });

        // Listen for hash changes (back/forward buttons)
        window.addEventListener('hashchange', () => this.router());
    },

    router() {
        const hash = window.location.hash;
        
        // Reset filters on navigation
        this.clearFilters(false);

        if (hash.startsWith('#/movie/')) {
            const id = hash.substring(8);
            if (!this.selectedMovie || this.selectedMovie.movie_id != id) {
                this.fetchMovie(id);
            }
        } else if (hash.startsWith('#/person/')) {
            const id = hash.substring(9);
            if (!this.selectedPerson || this.selectedPerson.person_id != id) {
                this.fetchPerson(id);
            }
        } else if (hash.startsWith('#/genre/')) {
            this.selectedGenre = decodeURIComponent(hash.substring(8));
            this.filterAndSortMovies();
            this.closeAllModals();
        } else if (hash.startsWith('#/country/')) {
            this.selectedCountry = decodeURIComponent(hash.substring(10));
            this.filterAndSortMovies();
            this.closeAllModals();
        } else if (hash.startsWith('#/language/')) {
            this.selectedLanguage = decodeURIComponent(hash.substring(11));
            this.filterAndSortMovies();
            this.closeAllModals();
        } else if (hash.startsWith('#/year/')) {
            this.selectedYear = decodeURIComponent(hash.substring(7));
            this.filterAndSortMovies();
            this.closeAllModals();
        } else if (hash.startsWith('#/franchise/')) {
            this.selectedFranchise = decodeURIComponent(hash.substring(12));
            this.filterAndSortMovies();
            this.closeAllModals();
        } else {
            this.closeAllModals();
        }
    },
    
    filterAndSortMovies() {
        // Filter
        let filtered = this.allMovies.filter(movie => {
            const matchesSearch = !this.searchQuery || 
                movie.movie_name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                (movie.original_title && movie.original_title.toLowerCase().includes(this.searchQuery.toLowerCase()));
            
            const matchesGenre = !this.selectedGenre || 
                (movie.genres || []).includes(this.selectedGenre);
            
            const matchesCountry = !this.selectedCountry || 
                (movie.countries || []).includes(this.selectedCountry);
            
            const matchesLanguage = !this.selectedLanguage || 
                (movie.languages || []).includes(this.selectedLanguage);
            
            const matchesFranchise = !this.selectedFranchise || 
                movie.franchise_id == this.selectedFranchise;
            
            const matchesYear = !this.selectedYear || 
                (movie.release_date && new Date(movie.release_date).getFullYear() == this.selectedYear);
            
            return matchesSearch && matchesGenre && matchesCountry && 
                   matchesLanguage && matchesFranchise && matchesYear;
        });
        
        // Sort
        filtered.sort((a, b) => {
            let aVal, bVal;
            
            switch(this.sortBy) {
                case 'name':
                    aVal = a.movie_name.toLowerCase();
                    bVal = b.movie_name.toLowerCase();
                    break;
                case 'date':
                    aVal = a.release_date || '0000-00-00';
                    bVal = b.release_date || '0000-00-00';
                    break;
                case 'rating':
                    aVal = a.rating || 0;
                    bVal = b.rating || 0;
                    break;
                case 'runtime':
                    aVal = a.runtime_minutes || 0;
                    bVal = b.runtime_minutes || 0;
                    break;
            }
            
            if (this.sortOrder === 'asc') {
                return aVal > bVal ? 1 : -1;
            } else {
                return aVal < bVal ? 1 : -1;
            }
        });
        
        this.movies = filtered;
        this.currentPage = 1;
    },
    
    clearFilters(updateHash = true) {
        this.searchQuery = '';
        this.selectedGenre = '';
        this.selectedCountry = '';
        this.selectedLanguage = '';
        this.selectedFranchise = '';
        this.selectedYear = '';
        this.filterAndSortMovies();
        if (updateHash) {
            window.location.hash = '';
        }
    },

    closeAllModals() {
        this.selectedMovie = null;
        this.selectedPerson = null;
        document.body.style.overflow = '';
    },
    
    // --- Data Fetching ---

    fetchMovie(id) {
        this.isLoading = true;
        fetch(`/api/movie/${id}`)
            .then(res => res.json())
            .then(data => {
                this.closeAllModals();
                this.selectedMovie = data;
                this.activeTab = 'general';
                this.isLoading = false;
                document.body.style.overflow = 'hidden';
            })
            .catch(err => {
                console.error('Failed to load movie details:', err);
                this.isLoading = false;
                window.location.hash = ''; // Go home on error
            });
    },

    fetchPerson(id) {
        this.isLoading = true;
        fetch(`/api/person/${id}`)
            .then(res => res.json())
            .then(data => {
                this.closeAllModals();
                this.selectedPerson = data;
                this.isLoading = false;
                document.body.style.overflow = 'hidden';
            })
            .catch(err => {
                console.error('Failed to load person details:', err);
                this.isLoading = false;
                window.location.hash = ''; // Go home on error
            });
    },

    // --- Navigation ---

    selectMovie(movie) {
        if (!movie || !movie.movie_id) return;
        window.location.hash = `/movie/${movie.movie_id}`;
    },
    
    selectPerson(person) {
        if (!person || !person.person_id) return;
        window.location.hash = `/person/${person.person_id}`;
    },

    closeMovie(updateHash = true) {
        this.selectedMovie = null;
        if (!this.selectedPerson) {
            document.body.style.overflow = '';
        }
        if (updateHash) {
            window.location.hash = '';
        }
    },
    
    closePerson(updateHash = true) {
        this.selectedPerson = null;
        if (!this.selectedMovie) {
            document.body.style.overflow = '';
        }
        if (updateHash) {
            window.location.hash = '';
        }
    },

    selectMovieFromPerson(movie) {
        // No need for timeout, hash change will trigger router
        this.selectMovie(movie);
    },
    
    // --- Getters ---

    get paginatedMovies() {
        const start = (this.currentPage - 1) * this.moviesPerPage;
        const end = start + this.moviesPerPage;
        return this.movies.slice(start, end);
    },
    
    get totalPages() {
        return Math.ceil(this.movies.length / this.moviesPerPage);
    },
    
    get years() {
        const yearSet = new Set();
        this.allMovies.forEach(movie => {
            if (movie.release_date) {
                yearSet.add(new Date(movie.release_date).getFullYear());
            }
        });
        return Array.from(yearSet).sort((a, b) => b - a);
    },
    
    // --- Formatting ---

    getImageUrl(item, type = 'poster') {
        if (!item) return 'https://placehold.co/500x750/0a0a0a/1a1a1a?text=NO+ASSET';

        let path;
        // Person images are handled differently
        if (type === 'person') {
            path = item.headshot_path;
            if (!path) return 'https://placehold.co/200x300/0a0a0a/1a1a1a?text=NO+PHOTO';
            // The path from DB is already 'people/123.jpg'
            return `/media/${path}`;
        }

        // Movie images
        switch(type) {
            case 'poster':
                path = item.poster_path;
                break;
            case 'backdrop':
                path = item.backdrop_path;
                break;
            default:
                path = item.poster_path;
        }
        
        if (!path) {
            return type === 'poster' 
                ? 'https://placehold.co/500x750/0a0a0a/1a1a1a?text=NO+POSTER'
                : 'https://placehold.co/1280x720/0a0a0a/1a1a1a?text=NO+BACKDROP';
        }
        // The path from DB is already 'movies/123/poster.jpg'
        return `/media/${path}`;
    },
    
    formatDate(dateString) {
        if (!dateString) return 'N/A';
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
    },
    
    formatRuntime(minutes) {
        if (!minutes) return 'N/A';
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        return `${hours}h ${mins}m`;
    },
    
    formatFileSize(mb) {
        if (!mb) return 'N/A';
        if (mb < 1024) return `${mb} MB`;
        return `${(mb / 1024).toFixed(2)} GB`;
    },
    
    formatBitrate(kbps) {
        if (!kbps) return 'N/A';
        if (kbps < 1000) return `${kbps} kbps`;
        return `${(kbps / 1000).toFixed(1)} Mbps`;
    }
}" :class="{ 'dark': isDark }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Database Explorer</title>
    <link rel="stylesheet" href="style.css">
    <script src="alpine.min.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body class="bg-white dark:bg-black text-black dark:text-white font-mono transition-colors duration-300">

    <div x-show="isLoading" x-transition class="loading-overlay">
        <div class="loading-terminal">
            <div class="loading-header">
                <span>SYSTEM://LOADING</span>
                <div class="loading-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <div class="main-container">
        
        <header class="header">
            <div class="header-content">
                <h1 class="logo">
                    <span class="logo-prefix">MDB://</span>
                    <span class="logo-main">EXPLORER</span>
                    <span class="logo-version">v2.0</span>
                </h1>
                
                <div class="header-controls">
                    <div class="stats-display">
                        <span class="stat-item">
                            <span class="stat-label">ENTRIES:</span>
                            <span class="stat-value" x-text="allMovies.length"></span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">FILTERED:</span>
                            <span class="stat-value" x-text="movies.length"></span>
                        </span>
                    </div>
                    
                    <button @click="currentView = (currentView === 'movies' ? 'statistics' : 'movies')" class="theme-toggle">
                        <span x-show="currentView === 'movies'">[STATISTICS]</span>
                        <span x-show="currentView === 'statistics'">[MOVIE_LIST]</span>
                    </button>
                    <button @click="isDark = !isDark" class="theme-toggle">
                        <span x-show="!isDark">[DARK_MODE]</span>
                        <span x-show="isDark">[LIGHT_MODE]</span>
                    </button>
                </div>
            </div>
        </header>

        <div x-show="selectedMovie" x-cloak class="movie-modal">
            <div @click="closeMovie()" class="movie-modal-backdrop" 
                 x-show="selectedMovie" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"></div>
            
            <div class="movie-modal-content" 
                 x-show="selectedMovie"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 translate-y-4">
                
                <div class="modal-header">
                    <div class="modal-title">
                        <h2 x-text="selectedMovie?.movie_name"></h2>
                        <p x-show="selectedMovie?.original_title" x-text="`[${selectedMovie?.original_title}]`"></p>
                    </div>
                    <button @click="closeMovie()" class="modal-close">[ESC]</button>
                </div>
                
                <div class="modal-backdrop" 
                     x-show="selectedMovie?.backdrop_path"
                     :style="`background-image: url(${getImageUrl(selectedMovie, 'backdrop')})`"></div>
                
                <div class="modal-body">
                    <div class="tab-navigation">
                        <button @click="activeTab = 'general'" 
                                :class="{ 'active': activeTab === 'general' }" 
                                class="tab-button">
                            <span class="tab-number">01</span>
                            <span class="tab-label">GENERAL</span>
                        </button>
                        <button @click="activeTab = 'cast'" 
                                :class="{ 'active': activeTab === 'cast' }" 
                                class="tab-button">
                            <span class="tab-number">02</span>
                            <span class="tab-label">CAST_CREW</span>
                        </button>
                        <button @click="activeTab = 'technical'" 
                                :class="{ 'active': activeTab === 'technical' }" 
                                class="tab-button">
                            <span class="tab-number">03</span>
                            <span class="tab-label">TECHNICAL</span>
                        </button>
                    </div>
                    
                    <div class="tab-content">
                        <div x-show="activeTab === 'general'" class="tab-panel">
                            <div class="movie-layout">
                                <div class="movie-poster">
                                    <img :src="getImageUrl(selectedMovie, 'poster')" 
                                         @error="$event.target.src='https://placehold.co/500x750/0a0a0a/1a1a1a?text=NO+POSTER'"
                                         :alt="selectedMovie?.movie_name">
                                </div>
                                
                                <div class="movie-info">
                                    <div class="info-section-box" x-show="selectedMovie?.rating">
                                        <h3 class="section-title">&gt;&gt; RATING</h3>
                                        <div class="rating-display">
                                            <span class="rating-value" x-text="selectedMovie?.rating ? Number(selectedMovie.rating).toFixed(1) : 'N/A'"></span>
                                            <span class="rating-max">/ 10</span>
                                        </div>
                                    </div>

                                    <div class="info-section-box">
                                        <h3 class="section-title">&gt;&gt; DESCRIPTION</h3>
                                        <p class="description" x-text="selectedMovie?.description || 'No description available.'"></p>
                                    </div>
                                    
                                    <div class="details-grid">
                                        <div class="detail-item">
                                            <span class="detail-label">RELEASE_DATE:</span>
                                            <span class="detail-value" x-text="formatDate(selectedMovie?.release_date)"></span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">RUNTIME:</span>
                                            <span class="detail-value" x-text="formatRuntime(selectedMovie?.runtime_minutes)"></span>
                                        </div>
                                        <div class="detail-item" x-show="selectedMovie?.franchise_name">
                                            <span class="detail-label">FRANCHISE:</span>
                                            <span class="detail-value" x-text="selectedMovie?.franchise_name"></span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">FILES:</span>
                                            <span class="detail-value" x-text="`${selectedMovie?.files?.length || 0} file(s)`"></span>
                                        </div>
                                    </div>
                                    
                                    <div class="info-section" x-show="selectedMovie?.genres?.length">
                                        <h3 class="section-title">&gt;&gt; GENRES</h3>
                                        <div class="tag-list">
                                            <template x-for="genre in selectedMovie?.genres" :key="genre">
                                                <a :href="`#/genre/${encodeURIComponent(genre)}`" class="tag" x-text="genre"></a>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <div class="info-section" x-show="selectedMovie?.languages?.length">
                                        <h3 class="section-title">&gt;&gt; LANGUAGES</h3>
                                        <div class="tag-list">
                                            <template x-for="lang in selectedMovie?.languages" :key="lang">
                                                <a :href="`#/language/${encodeURIComponent(lang)}`" class="tag" x-text="lang"></a>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <div class="info-section" x-show="selectedMovie?.countries?.length">
                                        <h3 class="section-title">&gt;&gt; COUNTRIES</h3>
                                        <div class="tag-list">
                                            <template x-for="country in selectedMovie?.countries" :key="country">
                                                <a :href="`#/country/${encodeURIComponent(country)}`" class="tag" x-text="country"></a>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <div class="info-section">
                                        <h3 class="section-title">&gt;&gt; EXTERNAL_LINKS</h3>
                                        <div class="external-links">
                                            <a x-show="selectedMovie?.imdb_id" 
                                               :href="`https://www.imdb.com/title/${selectedMovie?.imdb_id}`" 
                                               target="_blank" 
                                               class="external-link">IMDB</a>
                                            <a x-show="selectedMovie?.tmdb_id" 
                                               :href="`https://www.themoviedb.org/movie/${selectedMovie?.tmdb_id}`" 
                                               target="_blank" 
                                               class="external-link">TMDB</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div x-show="activeTab === 'cast'" class="tab-panel">
                            <div class="crew-section" x-show="selectedMovie?.directors?.length">
                                <h3 class="section-title">&gt;&gt; DIRECTORS</h3>
                                <div class="crew-list">
                                    <template x-for="director in selectedMovie?.directors" :key="director">
                                        <div class="crew-item">
                                            <span class="crew-name" x-text="director"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="crew-section" x-show="selectedMovie?.writers?.length">
                                <h3 class="section-title">&gt;&gt; WRITERS</h3>
                                <div class="crew-list">
                                    <template x-for="writer in selectedMovie?.writers" :key="writer.person_id">
                                        <div class="crew-item">
                                            <span class="crew-name" x-text="writer.full_name"></span>
                                            <span class="crew-role" x-text="`[${writer.credit_type_name}]`"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <div class="crew-section" x-show="selectedMovie?.cast?.length">
                                <h3 class="section-title">&gt;&gt; CAST</h3>
                                <div class="cast-grid">
                                    <template x-for="actor in selectedMovie?.cast" :key="actor.cast_id">
                                        <div @click.stop="selectPerson(actor)" class="cast-item">
                                            <img :src="getImageUrl(actor, 'person')" 
                                                 @error="$event.target.src='https://placehold.co/200x300/0a0a0a/1a1a1a?text=NO+PHOTO'"
                                                 :alt="actor.full_name"
                                                 class="cast-photo">
                                            <div class="cast-details">
                                                <div class="cast-name" x-text="actor.full_name"></div>
                                                <div class="cast-character" x-text="`as ${actor.character_name}`"></div>
                                                <div class="cast-role" x-show="actor.role_name" x-text="`[${actor.role_name}]`"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <div x-show="activeTab === 'technical'" class="tab-panel">
                            <div class="files-section">
                                <template x-for="(file, index) in selectedMovie?.files" :key="file.file_id">
                                    <div class="file-block">
                                        <div class="file-header">
                                            <span class="file-number" x-text="`FILE_${String(index + 1).padStart(2, '0')}`"></span>
                                            <span class="file-name" x-text="file.file_name"></span>
                                        </div>
                                        
                                        <div class="file-path">
                                            <span class="path-label">PATH:</span>
                                            <span class="path-value" x-text="file.file_path"></span>
                                        </div>
                                        
                                        <div class="file-details">
                                            <div class="file-detail-grid">
                                                <div class="file-detail">
                                                    <span class="detail-label">FORMAT:</span>
                                                    <span x-text="file.file_format || 'N/A'"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">SIZE:</span>
                                                    <span x-text="formatFileSize(file.file_size_mb)"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">RESOLUTION:</span>
                                                    <span x-text="file.resolution_name || 'N/A'"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">VIDEO_CODEC:</span>
                                                    <span x-text="file.video_codec || 'N/A'"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">BITRATE:</span>
                                                    <span x-text="formatBitrate(file.video_bitrate_kbps)"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">ASPECT_RATIO:</span>
                                                    <span x-text="file.aspect_ratio || 'N/A'"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">FRAMERATE:</span>
                                                    <span x-text="file.frame_rate_fps ? `${file.frame_rate_fps} fps` : 'N/A'"></span>
                                                </div>
                                                <div class="file-detail">
                                                    <span class="detail-label">SOURCE:</span>
                                                    <span x-text="file.source_type || 'N/A'"></span>
                                                </div>
                                            </div>
                                            
                                            <div class="tracks-section" x-show="file.audio_tracks?.length">
                                                <h4 class="tracks-title">// AUDIO_TRACKS</h4>
                                                <div class="tracks-list">
                                                    <template x-for="track in file.audio_tracks" :key="track.track_id">
                                                        <div class="track-item">
                                                            <span class="track-order" x-text="`[${track.track_order}]`"></span>
                                                            <span x-text="track.language || 'Unknown'"></span>
                                                            <span class="track-codec" x-text="track.codec"></span>
                                                            <span class="track-channels" x-text="track.channels"></span>
                                                            <span class="track-bitrate" x-text="formatBitrate(track.bitrate_kbps)"></span>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                            
                                            <div class="tracks-section" x-show="file.subtitles?.length">
                                                <h4 class="tracks-title">// SUBTITLES</h4>
                                                <div class="tracks-list">
                                                    <template x-for="sub in file.subtitles" :key="sub.subtitle_id">
                                                        <div class="track-item">
                                                            <span x-text="sub.language || 'Unknown'"></span>
                                                            <span class="track-format" x-text="`[${sub.format}]`"></span>
                                                            <span class="track-type" x-text="sub.is_embedded ? 'EMBEDDED' : 'EXTERNAL'"></span>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="selectedPerson" x-cloak class="movie-modal">
            <div @click="closePerson()" class="movie-modal-backdrop" 
                 x-show="selectedPerson" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"></div>
            
            <div class="movie-modal-content" 
                 x-show="selectedPerson"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 translate-y-4">
                
                <div class="modal-header">
                    <div class="modal-title">
                        <h2 x-text="selectedPerson?.full_name"></h2>
                    </div>
                    <button @click="closePerson()" class="modal-close">[ESC]</button>
                </div>
                
                <div class="modal-body">
                    <div class="person-layout">
                        <div class="person-photo">
                            <img :src="getImageUrl(selectedPerson, 'person')" 
                                 @error="$event.target.src='https://placehold.co/500x750/0a0a0a/1a1a1a?text=NO+PHOTO'"
                                 :alt="selectedPerson?.full_name">
                        </div>
                        
                        <div class="person-info">
                            <div class="info-section">
                                <h3 class="section-title">&gt;&gt; FILMOGRAPHY</h3>
                                <div class="filmography-grid">
                                    <template x-for="movie in selectedPerson?.movies" :key="movie.movie_id">
                                        <div class="movie-card" @click="selectMovieFromPerson(movie)">
                                            <div class="movie-card-inner">
                                                <img :src="getImageUrl(movie, 'poster')" 
                                                     @error="$event.target.src='https://placehold.co/500x750/0a0a0a/1a1a1a?text=NO+POSTER'"
                                                     :alt="movie.movie_name"
                                                     class="movie-poster-img">
                                                <div class="movie-card-overlay">
                                                    <h3 class="movie-card-title" x-text="movie.movie_name"></h3>
                                                    <p class="movie-card-year" x-text="movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A'"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <main x-show="!selectedMovie">
            <div x-show="currentView === 'movies'">
                <div class="controls-section">
                    <div class="search-bar">
                        <span class="search-icon">&gt;</span>
                        <input type="text" 
                               x-model="searchQuery" 
                               @input.debounce.300ms="filterAndSortMovies()"
                               placeholder="SEARCH_MOVIES..."
                               class="search-input">
                    </div>
                    
                    <div class="control-buttons">
                        <button @click="showFilters = !showFilters" 
                                :class="{ 'active': showFilters }"
                                class="control-btn">
                            <span x-text="showFilters ? '[HIDE_FILTERS]' : '[SHOW_FILTERS]'"></span>
                        </button>
                        
                        <div class="view-toggle">
                            <button @click="viewMode = 'grid'" 
                                    :class="{ 'active': viewMode === 'grid' }"
                                    class="view-btn">[GRID]</button>
                            <button @click="viewMode = 'list'" 
                                    :class="{ 'active': viewMode === 'list' }"
                                    class="view-btn">[LIST]</button>
                        </div>
                    </div>
                </div>
                
                <div x-show="showFilters" 
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 -translate-y-2"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100 translate-y-0"
                     x-transition:leave-end="opacity-0 -translate-y-2"
                     class="filters-panel">
                    
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label class="filter-label">GENRE:</label>
                            <select x-model="selectedGenre" @change="filterAndSortMovies()" class="filter-select">
                                <option value="">ALL_GENRES</option>
                                <template x-for="genre in genres" :key="genre.genre_id">
                                    <option :value="genre.genre_name" x-text="genre.genre_name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">YEAR:</label>
                            <select x-model="selectedYear" @change="filterAndSortMovies()" class="filter-select">
                                <option value="">ALL_YEARS</option>
                                <template x-for="year in years" :key="year">
                                    <option :value="year" x-text="year"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">COUNTRY:</label>
                            <select x-model="selectedCountry" @change="filterAndSortMovies()" class="filter-select">
                                <option value="">ALL_COUNTRIES</option>
                                <template x-for="country in countries" :key="country.country_id">
                                    <option :value="country.country_name" x-text="country.country_name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">LANGUAGE:</label>
                            <select x-model="selectedLanguage" @change="filterAndSortMovies()" class="filter-select">
                                <option value="">ALL_LANGUAGES</option>
                                <template x-for="language in languages" :key="language.language_id">
                                    <option :value="language.language_name" x-text="language.language_name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">FRANCHISE:</label>
                            <select x-model="selectedFranchise" @change="filterAndSortMovies()" class="filter-select">
                                <option value="">ALL_FRANCHISES</option>
                                <template x-for="franchise in franchises" :key="franchise.franchise_id">
                                    <option :value="franchise.franchise_id" x-text="franchise.franchise_name"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">SORT_BY:</label>
                            <select x-model="sortBy" @change="filterAndSortMovies()" class="filter-select">
                                <option value="name">NAME</option>
                                <option value="date">RELEASE_DATE</option>
                                <option value="rating">RATING</option>
                                <option value="runtime">RUNTIME</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">ORDER:</label>
                            <select x-model="sortOrder" @change="filterAndSortMovies()" class="filter-select">
                                <option value="asc">ASCENDING</option>
                                <option value="desc">DESCENDING</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <button @click="clearFilters()" class="clear-filters-btn">[CLEAR_ALL]</button>
                        </div>
                    </div>
                </div>
                
                <div x-show="viewMode === 'grid'" class="movies-grid">
                    <template x-for="movie in paginatedMovies" :key="movie.movie_id">
                        <div @click="selectMovie(movie)" class="movie-card">
                            <div class="movie-card-inner">
                                <img :src="getImageUrl(movie, 'poster')" 
                                     @error="$event.target.src='https://placehold.co/500x750/0a0a0a/1a1a1a?text=NO+POSTER'"
                                     :alt="movie.movie_name"
                                     class="movie-poster-img">
                                <div class="movie-card-overlay">
                                    <div class="movie-card-info">
                                        <h3 class="movie-card-title" x-text="movie.movie_name"></h3>
                                        <p class="movie-card-year" x-text="movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A'"></p>
                                        <div class="movie-card-rating" x-show="movie.rating">
                                            <span x-text="Number(movie.rating).toFixed(1)"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <div x-show="viewMode === 'list'" class="movies-list">
                    <div class="list-header">
                        <div class="list-col list-col-poster">POSTER</div>
                        <div class="list-col list-col-title">TITLE</div>
                        <div class="list-col list-col-year">YEAR</div>
                        <div class="list-col list-col-rating">RATING</div>
                        <div class="list-col list-col-runtime">RUNTIME</div>
                        <div class="list-col list-col-genres">GENRES</div>
                    </div>
                    <template x-for="movie in paginatedMovies" :key="movie.movie_id">
                        <div @click="selectMovie(movie)" class="list-item">
                            <div class="list-col list-col-poster">
                                <img :src="getImageUrl(movie, 'poster')" 
                                     @error="$event.target.src='https://placehold.co/92x138/0a0a0a/1a1a1a?text=NO'"
                                     :alt="movie.movie_name"
                                     class="list-poster">
                            </div>
                            <div class="list-col list-col-title">
                                <span x-text="movie.movie_name"></span>
                                <span class="list-original-title" x-show="movie.original_title" x-text="`[${movie.original_title}]`"></span>
                            </div>
                            <div class="list-col list-col-year" x-text="movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A'"></div>
                            <div class="list-col list-col-rating">
                                <span x-show="movie.rating" x-text="movie.rating"></span>
                                <span x-show="!movie.rating">--</span>
                            </div>
                            <div class="list-col list-col-runtime" x-text="formatRuntime(movie.runtime_minutes)"></div>
                            <div class="list-col list-col-genres">
                                <span x-text="(movie.genres || []).slice(0, 3).join(', ')"></span>
                            </div>
                        </div>
                    </template>
                </div>
                
                <div x-show="totalPages > 1" class="pagination">
                    <button @click="currentPage = Math.max(1, currentPage - 1)" 
                            :disabled="currentPage === 1"
                            class="pagination-btn">[PREV]</button>
                    
                    <div class="pagination-info">
                        <span>PAGE</span>
                        <input type="number" 
                               x-model.number="currentPage" 
                               @change="currentPage = Math.max(1, Math.min(totalPages, currentPage))"
                               :max="totalPages"
                               min="1"
                               class="pagination-input">
                        <span>OF</span>
                        <span x-text="totalPages"></span>
                    </div>
                    
                    <button @click="currentPage = Math.min(totalPages, currentPage + 1)" 
                            :disabled="currentPage === totalPages"
                            class="pagination-btn">[NEXT]</button>
                </div>
            </div>

            <div x-show="currentView === 'statistics'" x-cloak class="statistics-page" style="padding: 2rem;">
                <h2 class="section-title" style="margin-bottom: 2rem; font-size: 1.5rem;">&gt;&gt; DATABASE STATISTICS</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="stat-card" style="background-color: #1a1a1a; padding: 1.5rem; border: 1px solid #333;">
                        <h3 class="stat-title" style="font-size: 1rem; color: #888; margin-bottom: 0.5rem;">TOTAL_MOVIES</h3>
                        <p class="stat-value" x-text="statistics?.total_movies" style="font-size: 2.5rem; font-weight: bold; color: #fff;"></p>
                    </div>
                    <div class="stat-card" style="background-color: #1a1a1a; padding: 1.5rem; border: 1px solid #333;">
                        <h3 class="stat-title" style="font-size: 1rem; color: #888; margin-bottom: 0.5rem;">TOTAL_MEDIA_SIZE</h3>
                        <p class="stat-value" x-text="`${statistics?.total_size_gb} GB`" style="font-size: 2.5rem; font-weight: bold; color: #fff;"></p>
                    </div>
                    <div class="stat-card" style="background-color: #1a1a1a; padding: 1.5rem; border: 1px solid #333;">
                        <h3 class="stat-title" style="font-size: 1rem; color: #888; margin-bottom: 0.5rem;">TOTAL_WATCH_TIME</h3>
                        <p class="stat-value" x-text="`${statistics?.total_runtime_hours} Hours`" style="font-size: 2.5rem; font-weight: bold; color: #fff;"></p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div class="stat-list-card" style="background-color: #1a1a1a; padding: 1.5rem; border: 1px solid #333;">
                         <h3 class="section-title" style="margin-bottom: 1rem;">&gt;&gt; TOP 10 GENRES</h3>
                         <ul style="list-style: none; padding: 0;">
                            <template x-for="genre in statistics?.movies_per_genre" :key="genre.genre_name">
                                <li style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #222;">
                                    <span x-text="genre.genre_name" style="color: #ccc;"></span>
                                    <span x-text="genre.count" style="color: #fff; font-weight: bold;"></span>
                                </li>
                            </template>
                         </ul>
                    </div>
                    <div class="stat-list-card" style="background-color: #1a1a1a; padding: 1.5rem; border: 1px solid #333;">
                         <h3 class="section-title" style="margin-bottom: 1rem;">&gt;&gt; MOVIES PER YEAR</h3>
                         <ul style="list-style: none; padding: 0; max-height: 400px; overflow-y: auto;">
                            <template x-for="year in statistics?.movies_per_year" :key="year.year">
                                <li style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #222;">
                                    <span x-text="year.year" style="color: #ccc;"></span>
                                    <span x-text="year.count" style="color: #fff; font-weight: bold;"></span>
                                </li>
                            </template>
                         </ul>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="footer">
            <div class="footer-content">
                <span>MDB://EXPLORER v2.0</span>
                <span class="footer-separator">|</span>
                <span>DATABASE_ENTRIES: <span x-text="allMovies.length"></span></span>
                <span class="footer-separator">|</span>
                <span>SYSTEM_STATUS: [ONLINE]</span>
            </div>
        </footer>
    </div>

</body>
</html>